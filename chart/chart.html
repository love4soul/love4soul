
<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="initial-scale=1" />
        <title>Chart Library </title>
			<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>		      
    </head>
    <body style="margin:0">
        
        <script type="text/javascript" src="UmstelClient.js"></script>
        <div id="demo" style="width: 568px; height: 320px;">
        </div>
<script>
            var chart = umstelAPI.createChart('demo');
			var loadMoreRequest;
			var loadMoreTime;
			var ainterface;
			
			if (chart.loaded) {
			    //buildChart();
			    if (ainterface) {
			        ainterface.onChartLoaded();
			    }
			} else {
			    chart.onload = function(crt) {
			        chart = crt;
			        if (ainterface) {
			            ainterface.onChartLoaded();
			        }
			        //buildChart();
			    };
			}

            var loadMoreObj = {
                loadMore: function(time, request) {
			        if (ainterface) {
			            ainterface.onLoadMore();
			        }else{
						loadMoreRequest = request;
						loadMoreTime = time;
			        	window.location.href = "ios://loadmore";
			        }
                
                }
            };
			
			function addMoreData(initialData, reject){
				if(reject){
					loadMoreRequest.reject();
					return;
				}
				var times = [];
				var open = [];
				var high = [];
				var low = [];
				var close = [];
				var volume = [];
				for(var i = 0; i < initialData.length; i++){
					var point = initialData[i];
					times.push(parseFloat(point[0]));
					high.push(parseFloat(point[2]));
					open.push(parseFloat(point[1]));
					low.push(parseFloat(point[3]));
					close.push(parseFloat(point[4]));
					volume.push(parseFloat(point[5]));
				}
				loadMoreRequest.resolve({
				                time: times,
				                high: high,
				                low: low,
				                open: open,
				                close: close,
				                volume: volume
				            });
			}

            function buildChart(name, description, initialData, period, digit) {
                chart.setSymbol(name);
                chart.setDescription(description);
                chart.setChartHistoryLoader(loadMoreObj);
                
                chart.setSettings( 
                					{
                						g: {               								
												j:{
													z:{
														y:"#2B2B2B"
													},
													a1:{
														y:"#343434"
													},
													b1:{
														y:"#404040"
													},
													d1:{
														y:"#FFF"
													},
													h1:{
														y:0
													},
													g1:{
														y:0
													}
												},
												l:{
													l1:{
														y:"#50B848"
													},
													m1:{
														y:"#50B848"
													},
													n1:{
														y:"#9D3337"
													},
													01:{
														y:"#9D3337"
													},
												}
                							}
                					}
                				);
                
                chart.setRawData(false);
                chart.setDigits(digit);
                chart.setPeriod(period);
				
				var times = [];
				var open = [];
				var high = [];
				var low = [];
				var close = [];
				var volume = [];
				for(var i = 0; i < initialData.length; i++){
					var point = initialData[i];
					times.push(parseFloat(point[0])*0.001);
					high.push(parseFloat(point[2]));
					open.push(parseFloat(point[1]));
					low.push(parseFloat(point[3]));
					close.push(parseFloat(point[4]));
					volume.push(parseFloat(point[5]));
				}
				
				chart.setDataTime(times);
				chart.setDataOpen(open);
				chart.setDataHigh(high);
				chart.setDataLow(low);
				chart.setDataClose(close);
				chart.setDataVolume(volume);
				
                chart.build();

            }

            // removes a TA by array key
            function removeTA(key) {
                var tas = chart.getTAs();
                tas[key].remove();
            }

            // removes an Indicator by array key
            function removeIndicator(key) {
                var indicators = chart.getIndicators();
                indicators[key].remove();
            }

            function populateChartList() {
                console.log(chart.getTAs());

                // clear the list
                $('#chart-item-list').html('');

                // add TAs to list
                var tas = chart.getTAs();
                for(var i in tas) {
                    $('#chart-item-list').append( '<li><div>' + tas[i].getName() +' <input class="btn btn-primary remove-chart-item ' + tas[i].getName() +'" type="button" onclick="removeTA(' + i + ');" value="x" /></div></li>');
                }

                // add indicators to list
                var indicators = chart.getIndicators();
                for(var i in indicators) {
                    $('#chart-item-list').append( '<li><div>' + indicators[i].getName() +'<input class="btn btn-primary remove-chart-item" type="button" onclick="removeIndicator(' + i + ');" value="x" /></div></li>');
                }
            }
                    </script>
        
            
    </body>
</html>