
<!DOCTYPE html>
<!--[if IE 7]>
 <html class="ie ie7" lang="en-US">
 <![endif]-->
<!--[if IE 8]>
 <html class="ie ie8" lang="en-US">
 <![endif]-->
<!--[if !(IE 7) | !(IE 8)  ]><!-->
<html lang="en-US">
    <!--<![endif]-->
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="initial-scale=1" />
        <title>Chart Library </title>
        <!--[if lt IE 9]>
         <script src="/wp-content/themes/umstel/js/html5.js" type="text/javascript"></script>
         <![endif]-->
			<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
		
        
                </head>
    <body style="margin:0">
        
        <script type="text/javascript" src="UmstelClient.js"></script>
        <div id="demo" style="width: 568px; height: 300px;">
        </div>
<script>
            var chart = umstelAPI.createChart('demo');

            if (chart.loaded) {
                //buildChart();
            } else {
                chart.onload = function(crt) {
                    chart = crt;
                    //buildChart();
                };
            }
            var last_past_price = 1.00276; // for demo purposes only
            var last_live_price = 1; // for demo purposes only

            var obj = {
                loadMore: function(time, request) {/*
                
                                    $.post("http://www.iresearchfx.com/wp-content/themes/umstel/demo-chart-past.php?time=" + time + '&last_price=' + last_past_price, function(data) {
                                        var result = JSON.parse(data);
                
                                        last_past_price = result.close;
                                        request.resolve({
                                            time: result.time,
                                            high: result.high,
                                            low: result.low,
                                            open: result.open,
                                            close: result.close,
                                            volume: result.volume
                                        });
                                    }).fail(function() {
                                        request.reject();
                                    });*/
                
                }
            };

            function buildChart(name, description, initialData) {
                chart.setSymbol(name);
                chart.setDescription(description);
                chart.setChartHistoryLoader(obj);
                chart.setSettings( 
					{
						b : {
							d : 2
							
						},
						g: {
								n: {
									i1: { //main line color
										y: "red"
									},
									ji: { //main line width
										y: 1 //values from 1-5
									}
								}
							}
					}
				);
                chart.setRawData(false);
                chart.setDigits(5);
                chart.setPeriod(1);
				
				var times = [];
				var open = [];
				var high = [];
				var low = [];
				var close = [];
				var volume = [];
				for(var i = 0; i < initialData.length; i++){
					var point = initialData[i];
					times.push(parseFloat(point[0])*0.001);
					high.push(parseFloat(point[2]));
					open.push(parseFloat(point[1]));
					low.push(parseFloat(point[3]));
					close.push(parseFloat(point[4]));
					volume.push(parseFloat(point[5]));
				}
				
				chart.setDataTime(times);
				chart.setDataOpen(open);
				chart.setDataHigh(high);
				chart.setDataLow(low);
				chart.setDataClose(close);
				chart.setDataVolume(volume);
				
                chart.build();

            }

            // removes a TA by array key
            function removeTA(key) {
                var tas = chart.getTAs();
                tas[key].remove();
            }

            // removes an Indicator by array key
            function removeIndicator(key) {
                var indicators = chart.getIndicators();
                indicators[key].remove();
            }

            function populateChartList() {
                console.log(chart.getTAs());

                // clear the list
                $('#chart-item-list').html('');

                // add TAs to list
                var tas = chart.getTAs();
                for(var i in tas) {
                    $('#chart-item-list').append( '<li><div>' + tas[i].getName() +' <input class="btn btn-primary remove-chart-item ' + tas[i].getName() +'" type="button" onclick="removeTA(' + i + ');" value="x" /></div></li>');
                }

                // add indicators to list
                var indicators = chart.getIndicators();
                for(var i in indicators) {
                    $('#chart-item-list').append( '<li><div>' + indicators[i].getName() +'<input class="btn btn-primary remove-chart-item" type="button" onclick="removeIndicator(' + i + ');" value="x" /></div></li>');
                }
            }
                    </script>
        
            
    </body>
</html>